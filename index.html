<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>電子譜面（ジェスチャー操作）</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
}

#sheet {
  width: 100vw;
  height: 100vh;
  object-fit: contain;
}

#debug {
  position: fixed;
  bottom: 10px;
  left: 10px;
  color: red;
  font-size: 18px;
  background: rgba(0,0,0,0.5);
  padding: 6px;
}

#tapBtn {
  position: fixed;
  bottom: 10px;
  right: 10px;
  font-size: 18px;
  padding: 10px 16px;
}
</style>
</head>

<body>

<img id="sheet" src="score1.png">
<div id="debug">未検出</div>
<button id="tapBtn">▶ 次へ</button>
<video id="video" style="display:none"></video>

<script>
/* ===== 譜面 ===== */
const pages = [
  "score1.png",
  "score2.png",
  "score3.png",
  "score4.png",
  "score5.png",
  "score6.png",
  "score7.png",
  "score8.png",
  "score9.png"
];
let page = 0;

/* ===== 次ページ ===== */
let lastMove = 0;
function nextPage() {
  const now = Date.now();
  if (now - lastMove < 2000) return;
  lastMove = now;

  page++;
  if (page >= pages.length) page = pages.length - 1;
  document.getElementById("sheet").src = pages[page];
}

/* タップ保険 */
document.getElementById("tapBtn").onclick = nextPage;

/* ===== Android対策：先に許可を取る ===== */
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => stream.getTracks().forEach(t => t.stop()))
  .catch(()=>{});

/* ===== MediaPipe Hands ===== */
const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 0,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

const debug = document.getElementById("debug");

hands.onResults(results => {
  if (results.multiHandLandmarks &&
      results.multiHandLandmarks.length > 0) {
    debug.innerText = "✋ 手を検出！";
    nextPage();
  } else {
    debug.innerText = "未検出";
  }
});

/* ===== カメラ起動 ===== */
const camera = new Camera(document.getElementById("video"), {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});

camera.start();
</script>

</body>
</html>
